# 番茄钟统计功能

## 功能概述

Floato 现在支持可视化的番茄钟统计功能，可以帮助用户跟踪和分析番茄钟的使用情况。

## 功能特点

### 1. 自动统计记录
- 每当完成一个番茄钟时，系统会自动记录到统计数据中
- 数据按日期存储，支持历史记录查看
- 统计数据持久化保存在 UserDefaults 中

### 2. 统计视图
- **今日统计**: 显示今天完成的番茄钟数量
- **本周统计**: 显示最近7天的番茄钟总数
- **本月统计**: 显示最近30天的番茄钟总数
- **总计统计**: 显示所有时间的番茄钟总数

### 3. 双热力图可视化
- **日热力图**: 显示当天48个半小时区域的番茄钟分布
  - 分为上下两行：上行显示整点开始的半小时，下行显示半点开始的半小时
  - 颜色深浅基于番茄钟设置时长动态计算（例如25分钟设置下，30分钟内最多1个番茄钟）
- **年热力图**: 显示最近365天的番茄钟活动（GitHub风格）
- 颜色深浅代表活动强度（0-4级）
- 支持鼠标悬停显示详细信息
- 分离式布局，便于查看不同时间维度的数据

### 4. 访问方式
- 在菜单栏的设置界面中点击"查看统计"按钮
- 统计窗口以模态窗口形式显示
- 窗口尺寸：700x500 像素
- 支持水平滚动查看完整热力图
- 防止意外点击关闭

## 技术实现

### 核心组件

1. **StatisticsStore**: 统计数据模型
   - 负责数据的存储和读取
   - 提供统计摘要和热力图数据
   - 支持按日期记录和查询

2. **StatisticsView**: 统计界面
   - 显示统计卡片和热力图
   - 响应式布局设计
   - 支持模态展示

3. **DailyHeatmapView**: 日热力图组件
   - 48个半小时区域热力图（48个12x12像素方块）
   - 上下两行布局：上行显示整点开始的半小时，下行显示半点开始的半小时
   - 颜色深浅基于番茄钟设置时长动态计算强度等级
   - 支持鼠标悬停显示"HH:MM-HH:MM: N个番茄钟"

4. **YearlyHeatmapView**: 年热力图组件
   - 52周 x 7天的网格布局（GitHub风格）
   - 显示最近365天的番茄钟活动
   - 颜色深浅分5级表示活动强度
   - 支持鼠标悬停显示日期和数量

### 数据集成

- 统计数据通过 `TodoStore.statisticsStore` 访问
- 在 `markCurrentPomoDone()` 方法中自动记录
- **双重数据存储**：
  - 日级别统计：`pomodoro_statistics` 键
  - 半小时级别统计：`pomodoro_hourly_statistics` 键（实际存储30分钟间隔数据）
- 使用 JSON 格式存储到 UserDefaults
- 支持 `getTodayHalfHourlyData()` 和 `getHeatmapData()` 方法
- 动态颜色强度计算：基于番茄钟设置时长确定每个30分钟区域的理论最大番茄钟数

## 未来扩展

### 已完成的功能
- ✅ GitHub风格的年热力图
- ✅ 48个半小时区域的日热力图
- ✅ 双重数据存储（日级别和半小时级别）
- ✅ 基于番茄钟设置时长的动态颜色强度计算
- ✅ 鼠标悬停工具提示
- ✅ 防止点击误关闭
- ✅ 上下两行布局优化显示效果

### 可能的增强功能
- [ ] 按任务类别分类统计
- [ ] 周/月/年的统计趋势图
- [ ] 导出统计数据功能
- [ ] 设置统计目标和提醒
- [ ] 更丰富的图表样式选择
- [ ] 集成真正的 ContributionChart SPM 包（可选）

## 使用说明

1. 正常使用番茄钟完成任务
2. 每完成一个番茄钟，系统会自动记录到日/半小时统计
3. 在菜单栏设置中点击"查看统计"查看数据
4. 通过日热力图了解每日工作时间分布（48个半小时区域）
5. 通过年热力图了解长期番茄钟使用趋势
6. 鼠标悬停在方块上查看详细信息
7. 颜色深浅会根据番茄钟设置时长自动调整（25分钟/30分钟/其他）
8. 利用统计数据改进工作效率和时间管理

## 注意事项

- 统计数据从添加此功能后开始记录
- 数据存储在本地，不会上传到任何服务器
- 重装应用会清除统计数据
- **双重统计精度**：
  - 年热力图：按天累计计算
  - 日热力图：按30分钟间隔分别统计
- 半小时级别统计会自动记录番茄钟完成的具体时间段
- 颜色强度计算考虑番茄钟设置时长，确保合理的视觉反馈